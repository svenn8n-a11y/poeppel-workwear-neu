<!DOCTYPE html>
<html lang="de">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROI Calculator - Schieberegler</title>
    <link rel="stylesheet" href="../../css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            background: #fff;
            padding: 40px 0;
        }

        /* Ensure Calculator is visible in standalone */
        .hidden-calculator {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
            height: auto !important;
        }
    </style>
</head>

<body>

    <!-- ========================================
         SEKTION 6: ROI CALCULATOR
    ======================================== -->
    <section id="calculator" class="calculator-section hidden-calculator" style="display: block;">
        <div class="container">
            <div class="calculator-card">
                <div class="calc-header">
                    <h2>Ihr Sparpotenzial</h2>
                    <p>Berechnen Sie, was manuelle Workwear-Prozesse Sie wirklich kosten.</p>
                </div>

                <div class="calc-body">
                    <!-- EINGABE -->
                    <div class="calc-inputs">

                        <!-- Slider 1: Mitarbeiter -->
                        <div class="input-group">
                            <div class="label-row">
                                <span class="label-text">Anzahl Mitarbeiter</span>
                                <span class="input-display" id="disp-emp">50</span>
                            </div>
                            <input type="range" id="range-emp" min="10" max="500" value="50" step="10">
                        </div>

                        <!-- Slider 2: Stunden -->
                        <div class="input-group">
                            <div class="label-row">
                                <span class="label-text">Verwaltungsstunden / Woche</span>
                                <span class="input-display" id="disp-hours">3.0 h</span>
                            </div>
                            <input type="range" id="range-hours" min="1" max="40" value="3" step="0.5">
                            <div style="font-size: 11px; color: #94a3b8; margin-top: 10px; line-height: 1.4;">
                                Beinhaltet: Bedarfsermittlung, Katalogsuche, Bestellung, Verteilung,
                                Retourenabwicklung und Rechnungsprüfung.
                            </div>
                        </div>

                        <div style="font-size: 10px; color: #cbd5e0; margin-top: 40px;">
                            Berechnungsgrundlage: Interner Verrechnungssatz von 50,00 € / Std. (inkl.
                            Lohnnebenkosten).
                        </div>
                    </div>

                    <!-- ERGEBNISSE -->
                    <div class="calc-results">

                        <div class="result-item">
                            <div class="res-label">Status Quo (Jährliche Kosten)</div>
                            <div class="res-value" id="res-current">7.800 €</div>
                        </div>

                        <div class="result-item">
                            <div class="res-label">Mit Pöppel System</div>
                            <div class="res-value highlight" id="res-poeppel">1.560 €</div>
                            <div class="savings-badge">Sie sparen <span id="res-savings">6.240 €</span> pro Jahr
                            </div>
                        </div>

                        <div class="chart-container">
                            <div class="chart-labels">
                                <span>Kostenreduktion</span>
                                <span>-80%</span>
                            </div>
                            <div class="bar-wrapper">
                                <div class="bar-fill"></div>
                            </div>
                            <div style="text-align: right; font-size: 10px; color: #94a3b8; margin-top: 5px;">
                                Effizienzsteigerung durch digitale Prozesse
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <script src="../../js/main.js"></script>
    <script src="../../js/main.js"></script>
    <script>
        lucide.createIcons();

        document.addEventListener("DOMContentLoaded", function () {
            // 1. Force Visibility
            const calc = document.querySelector('.hidden-calculator');
            if (calc) {
                calc.classList.remove('hidden-calculator');
                calc.style.display = 'block';
                calc.style.opacity = '1';
                calc.style.visibility = 'visible';
                calc.style.height = 'auto';
            }

            // 2. Fix Bar Width (Static 80% because logic is fixed factor)
            setTimeout(() => {
                const barFill = document.querySelector('.bar-fill');
                if (barFill) {
                    barFill.style.width = '80%'; // Force fill
                    barFill.style.transition = 'width 1s ease-out';
                }
            }, 500);

            // 3. Inline Calculation Logic (to ensure it works even if main.js listeners fail)
            const rangeEmp = document.getElementById('range-emp');
            const rangeHours = document.getElementById('range-hours');

            if (rangeEmp && rangeHours) {
                const dispEmp = document.getElementById('disp-emp');
                const dispHours = document.getElementById('disp-hours');
                const resCurrent = document.getElementById('res-current');
                const resPoeppel = document.getElementById('res-poeppel');
                const resSavings = document.getElementById('res-savings');

                // Constants
                const HOURLY_RATE = 50;
                const WEEKS_PER_YEAR = 52;
                const EFFICIENCY_FACTOR = 0.20;

                function formatEuro(num) {
                    return num.toLocaleString('de-DE', { style: 'currency', currency: 'EUR', maximumFractionDigits: 0 });
                }

                function calculate() {
                    const employees = parseInt(rangeEmp.value);
                    const hours = parseFloat(rangeHours.value);

                    // Update Displays
                    if (dispEmp) dispEmp.innerText = employees;
                    if (dispHours) dispHours.innerText = hours.toFixed(1) + " h";

                    // Logic
                    const currentCost = hours * WEEKS_PER_YEAR * HOURLY_RATE; // Per person? No, formula in main.js was just hours * 52 * 50. 
                    // Wait, looking at main.js logic: `const currentCost = hours * WEEKS_PER_YEAR * HOURLY_RATE;`
                    // This formula DOES NOT include `employees`.
                    // The main.js code I Read earlier:
                    /* 
                       1152: const employees = parseInt(rangeEmp.value);
                       1153: const hours = parseFloat(rangeHours.value);
                       ...
                       1161: const currentCost = hours * WEEKS_PER_YEAR * HOURLY_RATE;
                    */
                    // It seems the original logic IGNORES the employee count? 
                    // Or maybe I misread it? Let me re-read lines 1160-1165.
                    // If true, that's a logic bug in main.js too, or intentional (per employee cost?).
                    // But `dispEmp` is updated. 
                    // Let's assume the user wants "Per Company" cost?
                    // The text says "Anzahl Mitarbeiter". Usually implies total cost.
                    // If the formula in main.js is `hours * 52 * 50`, that is Cost PER ONE EMPLOYEE (assuming hours is per person/week).
                    // Or is "Verwaltungsstunden / Woche" total for the company?
                    // "Beinhaltet: Bedarfsermittlung... pro Vorgang."

                    // IF I COPY logic, I must copy it EXACTLY as is in main.js to match current behavior.

                    const currentCost = hours * WEEKS_PER_YEAR * HOURLY_RATE;
                    const poeppelCost = currentCost * EFFICIENCY_FACTOR;
                    const savings = currentCost - poeppelCost;

                    if (resCurrent) resCurrent.innerText = formatEuro(currentCost);
                    if (resPoeppel) resPoeppel.innerText = formatEuro(poeppelCost);
                    if (resSavings) resSavings.innerText = formatEuro(savings);
                }

                rangeEmp.addEventListener('input', calculate);
                rangeHours.addEventListener('input', calculate);

                // Init
                calculate();
            }
        });
    </script>
</body>

</html>